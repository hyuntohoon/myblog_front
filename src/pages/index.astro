---
import Layout from '@layouts/layout.astro'
import Seo from '@components/seo.astro'
import { getCollection } from 'astro:content'
import SkipNavContent from '@components/a11y/skip-nav-content.astro'
import { defaultDateFormat, sortAsc } from '@utils'
import Link from '@components/link.astro'
import PostMetricsItem from '@components/post-metrics-item.tsx'

const posts = sortAsc(await getCollection('blog'))
---

<Layout>
  <Seo slot="seo" title="Blog" />
  <SkipNavContent>
    <h1 class="sr-only">Blog</h1>

    <!-- 헤더(표 설명) -->
    <div class="text-faded border-b border-border pb-2 mb-2
                grid grid-cols-[auto_1fr_auto_auto] gap-x-3 items-center">
      <span class="text-sm">Category</span>
      <span class="text-sm">Title</span>
      <span class="text-sm">Date</span>
      <span class="text-sm">Metrics</span>
    </div>

    <!-- 목록 -->
    <div class="divide-y divide-border">
      {
        posts.map(({ data: post }) => (
          <div class="grid grid-cols-[auto_1fr_auto_auto] gap-x-3 items-center py-3">
            <!-- [Category] -->
            <Link
              href={`/blog/category/${encodeURIComponent(post.category)}/`}
              class="font-mono text-xs md:text-sm px-1.5 py-0.5 rounded border border-border text-faded hover:text-highlight"
            >
              [{post.category}]
            </Link>

            <!-- Title (+ 평점 뱃지: 있으면만) -->
            <div class="flex items-center gap-2 min-w-0">
              <Link
                variant="highlight"
                class="font-medium text-base md:text-lg truncate"
                href={`/blog/${post.slug}/`}
                title={post.title}
              >
                {post.title}
              </Link>

              {post.musicReview && post.musicReview.rating && (
                <span class="shrink-0 rounded px-2 py-0.5 text-xs bg-muted text-highlight"
                      title="Rating">
                  ★ {post.musicReview.rating.value}/{post.musicReview.rating.scale}
                </span>
              )}
            </div>

            <!-- Date -->
            <span class="text-faded whitespace-nowrap">
              {defaultDateFormat(post.date)}
            </span>

            <!-- Metrics -->
            <span class="text-faded whitespace-nowrap">
              <PostMetricsItem client:load slug={post.slug} />
            </span>
          </div>
        ))
      }
    </div>
  </SkipNavContent>
</Layout>