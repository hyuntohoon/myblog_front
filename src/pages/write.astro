---
import Layout from '@layouts/layout.astro'
import Seo from '@components/seo.astro'
import Spacer from '@components/spacer.astro'
import SearchBar from '@components/search-bar.astro'

const detailClient = '/src/scripts/albumDetail.client.ts'
---

<Layout>
  <Seo slot="seo" title="Write a new post" />

  <div class="max-w-5xl mx-auto px-4 py-8">
    <h1 class="text-2xl font-bold mb-6">Write a new post</h1>

    <form id="write-form" class="space-y-6">
      <!-- 제목 + 카테고리 한 줄 -->
      <div class="flex flex-col gap-1">
  <div class="flex items-center gap-3">
    <!-- 제목 -->
    <input
      type="text"
      id="title"
      name="title"
      class="flex-1 border border-gray-300 px-3 py-2 rounded text-base"
      placeholder="제목"
      required
    />

    <!-- 카테고리 -->
    <div class="flex items-center gap-2">
      <select
        name="category"
        id="category"
        class="border border-gray-300 px-3 py-2 rounded text-base w-32 md:w-40"
      >
        <option disabled selected>Loading...</option>
      </select>
      <button
        type="button"
        id="add-category"
        class="border border-dashed border-gray-400 px-3 py-2 rounded text-base hover:bg-muted"
      >
        +
      </button>
    </div>
  </div>

  <p id="titleError" class="text-xs text-red-500 hidden">
    제목을 입력하세요.
  </p>
</div>

      <!-- 날짜 필드 없음 -->

      <!-- 음악 검색/선택 -->
      <section
        id="album-search-section"
        class="mt-2 border border-gray-200 rounded px-3 py-3 space-y-3"
      >
        <SearchBar />

        <!-- 선택된 앨범 표시 -->
        <div id="albumDetail" class="mt-2"></div>

        <!-- 선택 결과(hidden) -->
        <input type="hidden" id="albumIds" name="album_ids" value="[]">
        <input type="hidden" id="artistIds" name="artist_ids" value="[]">
      </section>

      <!-- 본문: Toast UI Editor 컨테이너 + 숨겨진 textarea (백엔드용) -->
      <div>
        <div
          id="editor"
          class="border border-gray-300 rounded"
        ></div>

        <!-- JS에서 getContent()로만 쓰고, 폴백/백엔드용 -->
        <textarea
          name="content"
          id="content"
          class="hidden"
        ></textarea>
      </div>

      <!-- 제출 -->
      <div class="flex items-center gap-3">
        <button
          id="submit-btn"
          type="submit"
          class="bg-highlight text-white px-4 py-2 rounded hover:bg-opacity-80 text-sm"
        >
          Save
        </button>
        <p id="write-result" class="text-xs mt-1"></p>
      </div>
    </form>

    <Spacer axis="vertical" size={8} />
  </div>

  <!-- 로그인 가드 -->
  <script src="../scripts/write.guard.ts"></script>

  <!-- 앨범 디테일 클라이언트 -->
  <script type="module" src={detailClient}></script>

  <!-- 폼 로직 -->
  <script src="../scripts/write/index.ts"></script>
</Layout>