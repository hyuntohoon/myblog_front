---
import Layout from '@layouts/layout.astro'
import Seo from '@components/seo.astro'
import Spacer from '@components/spacer.astro'
import SearchBar from '@components/search-bar.astro'
const detailClient = '/src/scripts/albumDetail.client.ts';
---

<Layout>
  <Seo slot="seo" title="Write a new post" />
  <link rel="stylesheet" href="https://unpkg.com/easymde/dist/easymde.min.css" />

  <div class="max-w-3xl mx-auto p-6">
    <h1 class="text-2xl font-bold mb-6">Write a new post</h1>

    <form id="write-form" class="space-y-6">
      <!-- ì œëª© -->
      <div>
        <input
          type="text"
          id="title"
          name="title"
          class="w-full border p-2 rounded"
          required
        />
        <p id="titleError" class="text-xs text-red-500 mt-1 hidden">
          ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”.
        </p>
      </div>

      <!-- ë‚ ì§œ -->
      <div>
        <label class="block font-medium mb-1">Date</label>
        <input type="date" name="posted_date" class="w-full border p-2 rounded" />
        <p class="text-xs text-faded mt-1">ë¹„ìš°ë©´ ì˜¤ëŠ˜ ë‚ ì§œë¡œ ì €ì¥ë©ë‹ˆë‹¤.</p>
      </div>

      <!-- ì¹´í…Œê³ ë¦¬ -->
      <div>
        <label class="block font-medium mb-1">Category</label>
        <div class="flex items-center gap-2">
          <select name="category" id="category" class="border p-2 rounded flex-1">
            <option disabled selected>Loading...</option>
          </select>
          <button
            type="button"
            id="add-category"
            class="border border-dashed px-3 py-1 rounded text-sm hover:bg-muted"
          >
            + Add
          </button>
        </div>
        <p id="catHelp" class="text-xs text-faded mt-1 hidden">
          No categories yet. You can add one.
        </p>
      </div>

      <!-- ì˜µì…˜ -->
      <div class="flex items-center gap-2">
        <input type="checkbox" id="enableReview" name="enableReview" class="w-4 h-4" />
        <label for="enableReview" class="font-medium">Add Music Review (optional)</label>
      </div>


      <!-- SearchBar ì‚½ì… -->
      <section id="album-search-section" class="mt-6 space-y-4">
        <SearchBar />
      </section>

      <!-- ì„ íƒëœ ì•¨ë²” í‘œì‹œ -->
      <div id="albumDetail"></div>

      <input type="hidden" id="albumIds" name="album_ids" value="[]">

      <!-- Music Review -->
      <fieldset id="musicReview" class="border rounded p-4 space-y-4 hidden">
        <legend class="font-semibold text-lg">ğŸ§ Music Review</legend>

        <div>
          <label class="block font-medium mb-1">Target Type</label>
          <select name="reviewType" id="reviewType" class="border p-2 rounded w-full">
            <option value="">Select...</option>
            <option value="album">Album</option>
            <option value="track">Track</option>
          </select>
        </div>

        <div>
          <label class="block font-medium mb-1">Select Album/Track</label>
          <select name="albumId" id="albumId" class="border p-2 rounded w-full">
            <option value="">(Select from chosen albums/tracks)</option>
          </select>

          <div id="albumPreview" class="mt-2 hidden">
            <img src="" alt="Album preview" class="rounded shadow w-32" />
          </div>
        </div>

        <div>
          <label class="block font-medium mb-1">Rating (0â€“10)</label>
          <input
            type="number"
            name="rating"
            class="border p-2 rounded w-24"
            min="0"
            max="10"
            step="0.5"
          />
        </div>
      </fieldset>

      <!-- ë³¸ë¬¸ -->
      <div>
        <label class="block font-medium mb-1">Content (Markdown/MDX)</label>
        <textarea
          name="content"
          id="content"
          class="w-full border p-2 rounded font-mono text-sm"
          rows="12"
          placeholder="# Heading\n\nWrite here..."
          required
        ></textarea>
      </div>

      <button
        id="submit-btn"
        type="submit"
        class="bg-highlight text-white px-4 py-2 rounded hover:bg-opacity-80"
      >
        Save
      </button>
      <p id="write-result" class="text-sm mt-2"></p>
    </form>

    <Spacer axis="vertical" size={8} />
  </div>

  <!-- ë¡œê·¸ì¸ -->
  <script src="../scripts/write.guard.ts"></script>
<script type="module" src={detailClient}></script>
  <!-- í´ë¼ì´ì–¸íŠ¸ -->
  <script src="../scripts/write/index.ts"></script>
</Layout>