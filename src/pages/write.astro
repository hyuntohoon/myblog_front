---
// src/pages/write.astro
import Layout from '@layouts/layout.astro'
import Seo from '@components/seo.astro'
import Spacer from '@components/spacer.astro'
---
<Layout>
  <Seo slot="seo" title="Write a new post" />

  <div class="max-w-3xl mx-auto p-6">
    <h1 class="text-2xl font-bold mb-6">Write a new post</h1>

    <form id="write-form" class="space-y-6">
      <!-- ì œëª© -->
      <div>
        <label class="block font-medium mb-1">Title</label>
        <input type="text" name="title" class="w-full border p-2 rounded" required />
      </div>

      <!-- ë‚ ì§œ(ì„ íƒ) -->
      <div>
        <label class="block font-medium mb-1">Date</label>
        <input type="date" name="posted_date" class="w-full border p-2 rounded" />
        <p class="text-xs text-faded mt-1">ë¹„ìš°ë©´ ì˜¤ëŠ˜ ë‚ ì§œë¡œ ì €ì¥ë©ë‹ˆë‹¤.</p>
      </div>

      <!-- ì¹´í…Œê³ ë¦¬ -->
      <div>
        <label class="block font-medium mb-1">Category</label>
        <div class="flex items-center gap-2">
          <select name="category" id="category" class="border p-2 rounded flex-1">
            <option disabled selected>Loading...</option>
          </select>
          <button type="button" id="add-category" class="border border-dashed px-3 py-1 rounded text-sm hover:bg-muted">
            + Add
          </button>
        </div>
        <p id="catHelp" class="text-xs text-faded mt-1 hidden">No categories yet. You can add one.</p>
      </div>

      <!-- ì˜µì…˜ í† ê¸€ -->
      <div class="flex items-center gap-2">
        <input type="checkbox" id="enableReview" name="enableReview" class="w-4 h-4" />
        <label for="enableReview" class="font-medium">Add Music Review (optional)</label>
      </div>

      <!-- Music Review -->
      <fieldset id="musicReview" class="border rounded p-4 space-y-4 hidden">
        <legend class="font-semibold text-lg">ğŸ§ Music Review</legend>

        <div>
          <label class="block font-medium mb-1">Target Type</label>
          <select name="reviewType" id="reviewType" class="border p-2 rounded w-full">
            <option value="">Select...</option>
            <option value="album">Album</option>
            <option value="track">Track</option>
          </select>
        </div>

        <div>
          <label class="block font-medium mb-1">Select Album/Track</label>
          <select name="albumId" id="albumId" class="border p-2 rounded w-full">
            <option value="">(Dummy Data)</option>
            <option value="1">NewJeans - Super Shy</option>
            <option value="2">IU - Love wins all</option>
            <option value="3">LE SSERAFIM - Easy</option>
          </select>

          <div id="albumPreview" class="mt-2 hidden">
            <img src="" alt="Album preview" class="rounded shadow w-32" />
          </div>
        </div>

        <div>
          <label class="block font-medium mb-1">Rating (0â€“10)</label>
          <input type="number" name="rating" class="border p-2 rounded w-24" min="0" max="10" step="0.5" />
        </div>
      </fieldset>

      <!-- ë³¸ë¬¸ -->
      <div>
        <label class="block font-medium mb-1">Content (Markdown/MDX)</label>
        <textarea
          name="content"
          class="w-full border p-2 rounded font-mono text-sm"
          rows="12"
          placeholder="# Heading\n\nWrite here..."
          required
        ></textarea>
      </div>

      <button id="submit-btn" type="submit" class="bg-highlight text-white px-4 py-2 rounded hover:bg-opacity-80">
        Save
      </button>
      <p id="write-result" class="text-sm mt-2"></p>
    </form>

    <Spacer axis="vertical" size={8} />
  </div>

  <!-- âœ… ë¡œê·¸ì¸ ê°€ë“œ: ë¡œê·¸ì¸ ì•ˆ ë˜ì–´ ìˆìœ¼ë©´ Cognito ë¡œê·¸ì¸ â†’ ì™„ë£Œ í›„ /write ë³µê·€ -->
  <script type="module">
    import { isLoggedIn, goLogin } from '/src/lib/auth.ts';

    (async () => {
      if (!isLoggedIn()) {
        // ë¡œê·¸ì¸ í›„ ë‹¤ì‹œ /write ë¡œ ëŒì•„ì˜¤ê²Œ
        await goLogin(true, '/write');
      }
    })();
  </script>

  <!-- âœ… í´ë¼ì´ì–¸íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© (ê¸°ì¡´ íŒŒì¼ í™œìš©) -->
  <!-- ì£¼ì˜: Astroì—ì„  inline importë¥¼ ì“°ê±°ë‚˜ src ì†ì„±ìœ¼ë¡œ ESM ëª¨ë“ˆì„ ë¡œë“œí•´ì•¼ í•¨ -->
  <script src="../scripts/write.client.ts"></script>
</Layout>