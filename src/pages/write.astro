---
import Layout from '@layouts/layout.astro'
import Seo from '@components/seo.astro'
import Spacer from '@components/spacer.astro'
import SearchBar from '@components/search-bar.astro'

const detailClient = '/src/scripts/albumDetail.client.ts'
---

<Layout>
  <Seo slot="seo" title="Write a new post" />

  <main class="container py-8">
    <h1 class="text-2xl font-bold mb-6">Write a new post</h1>

    <form id="write-form" class="space-y-6">
      <!-- ì œëª© + ì¹´í…Œê³ ë¦¬ -->
      <div class="flex flex-col gap-1">
        <div class="flex items-center gap-3">
          <input
            type="text"
            id="title"
            name="title"
            class="flex-1 border border-gray-300 px-3 py-2 rounded text-base"
            placeholder="ì œëª©"
            required
          />
          <div class="flex items-center gap-2">
            <select
              name="category"
              id="category"
              class="border border-gray-300 px-3 py-2 rounded text-base w-32 md:w-40"
            >
              <option disabled selected>Loading...</option>
            </select>
            <button
              type="button"
              id="add-category"
              class="border border-dashed border-gray-400 px-3 py-2 rounded text-base hover:bg-muted"
            >
              +
            </button>
          </div>
        </div>
        <p id="titleError" class="text-xs text-red-500 hidden">
          ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”.
        </p>
      </div>

      <!-- ìŒì•… ê²€ìƒ‰ -->
      <section
        id="album-search-section"
        class="mt-2 border border-gray-200 rounded px-3 py-3 space-y-3"
      >
        <SearchBar />
        <div id="albumDetail" class="mt-2"></div>

        <!-- âœ… í‰ì  ì…ë ¥: JSë¡œ show/hide -->
        <div
          id="rating-section"
          class="mt-3 flex items-center gap-2 text-sm text-gray-700 hidden"
        >
          <label for="rating" class="shrink-0 font-medium">Rating</label>
          <input
            type="number"
            id="rating"
            name="rating"
            min="0"
            max="10"
            step="0.5"
            class="w-20 border border-gray-300 rounded px-2 py-1 text-sm"
            placeholder="0â€“10"
          />
          <span class="text-xs text-gray-400">0â€“10 (0.5 step)</span>
          <div id="rating-stars" class="ml-2 flex text-amber-400 text-xs"></div>
        </div>

        <!-- hidden inputs -->
        <input type="hidden" id="albumIds" name="album_ids" value="[]" />
        <input type="hidden" id="artistIds" name="artist_ids" value="[]" />
      </section>

      <!-- ë³¸ë¬¸ ì—ë””í„° -->
      <div>
        <div id="editor" class="border border-gray-300 rounded"></div>
        <textarea name="content" id="content" class="hidden"></textarea>
      </div>

      <!-- ì œì¶œ -->
      <div class="flex items-center gap-3">
        <button
          id="submit-btn"
          type="submit"
          class="bg-highlight text-white px-4 py-2 rounded hover:bg-opacity-80 text-sm"
        >
          Save
        </button>
        <p id="write-result" class="text-xs mt-1"></p>
      </div>
    </form>

    <Spacer axis="vertical" size={8} />
  </main>

  <!-- ìŠ¤í¬ë¦½íŠ¸ -->
  <script src="../scripts/write.guard.ts"></script>
  <script type="module" src={detailClient}></script>
  <script src="../scripts/write/index.ts"></script>

  <!-- ğŸ”¥ í‰ì  ìë™ ë…¸ì¶œ ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    window.addEventListener('album:detail', () => {
      const ratingSection = document.getElementById('rating-section')
      if (ratingSection) ratingSection.classList.remove('hidden')
    })
  </script>
</Layout>