---
import Layout from '@layouts/layout.astro'
import Seo from '@components/seo.astro'
import { getCollection } from 'astro:content'
import SkipNavContent from '@components/a11y/skip-nav-content.astro'
import { defaultDateFormat, sortAsc } from '@utils'
import Link from '@components/link.astro'
import PostMetricsItem from '@components/post-metrics-item.tsx'

// /blog/category/<category> 정적 경로 생성
export async function getStaticPaths() {
  const entries = await getCollection('blog')
  const cats = new Set(entries.filter(e => !e.data.draft).map(e => e.data.category))
  return Array.from(cats).map((category) => ({ params: { category } }))
}

const all = await getCollection('blog')
const current = Astro.params.category!
const posts = sortAsc(
  all.filter(e => !e.data.draft && e.data.category === current)
)
---

<Layout>
  <Seo slot="seo" title={`Category: ${current}`} />
  <SkipNavContent>
    <h1 class="sr-only">Category: {current}</h1>

    <!-- 헤더(표 설명) -->
    <div class="text-faded border-b border-border pb-2 mb-2
                grid grid-cols-[1fr_auto_auto] gap-x-3 items-center">
      <span class="text-sm">Title</span>
      <span class="text-sm">Date</span>
      <span class="text-sm">Metrics</span>
    </div>

    <!-- 목록: 블로그 목록과 동일 템플릿(카테고리 열만 제거) -->
    <div class="divide-y divide-border">
      {
        posts.length === 0 ? (
          <div class="py-6 text-faded">No posts in this category.</div>
        ) : (
          posts.map(({ data: post }) => (
            <div class="grid grid-cols-[1fr_auto_auto] gap-x-3 items-center py-3">
              <!-- Title -->
              <Link
                variant="highlight"
                class="font-medium text-base md:text-lg truncate"
                href={`/blog/${post.slug}/`}
                title={post.title}
              >
                {post.title}
              </Link>

              <!-- Date -->
              <span class="text-faded whitespace-nowrap">
                {defaultDateFormat(post.date)}
              </span>

              <!-- Metrics -->
              <span class="text-faded whitespace-nowrap">
                <PostMetricsItem client:load slug={post.slug} />
              </span>
            </div>
          ))
        )
      }
    </div>
  </SkipNavContent>
</Layout>