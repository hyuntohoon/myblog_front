---
// frontmatter 불필요
const dbClient = '/src/scripts/searchBarDb.client.ts'
const spClient = '/src/scripts/searchBarSpotify.client.ts'
---

<style>
  /* 기본 박스 */
  .searchbar {
    --bg: #f3f4f6; --bd: #d1d5db; --fg: #111827;
    display: grid;
    grid-template-columns: auto minmax(280px, 1fr) auto;
    align-items: center;
    gap: .5rem;
    padding: .5rem .75rem;
    border: 1px solid var(--bd);
    border-radius: 8px;
    background: var(--bg);
    color: var(--fg);
    transition: background .15s ease, border-color .15s ease, box-shadow .15s ease, color .15s ease;
    box-shadow: 0 1px 2px rgba(0,0,0,.04);
  }

  /* ✅ 테마를 같은 요소에 붙여서 명시도 확보 */
  .searchbar.theme-none { --bg:#f3f4f6; --bd:#d1d5db; --fg:#111827; }
  .searchbar.theme-artist { --bg:#eef2ff; --bd:#c7d2fe; --fg:#3730a3; }
  .searchbar.theme-album  { --bg:#ecfdf5; --bd:#a7f3d0; --fg:#065f46; }
  /* 필요하면 트랙도 here:
     .searchbar.theme-track { --bg:#fff7ed; --bd:#fed7aa; --fg:#9a3412; } */

  .searchForm { 
    display:flex; 
    align-items:center; 
    gap:.5rem; 
    min-width: 280px;
  }

  /* 토글(버튼) */
  .toggle{
    border:1px solid transparent;
    padding:.4rem .7rem;
    border-radius:8px;
    font-size:.9rem;
    font-weight:600;
    background:transparent;
    transition:background .15s, border-color .15s, color .15s;
    color: var(--fg);
  }
  .toggle:hover{ cursor:pointer; background:rgba(0,0,0,.05); }
  .toggle[aria-pressed="true"]{
    background:rgba(255,255,255,.55);
    border-color:rgba(0,0,0,.15);
  }

  /* 인풋/버튼 */
  .input{
    width:100%;
    background:#fff;
    border:1px solid #d1d5db;
    border-radius:8px;
    font-size:1rem;
    padding:.5rem .75rem;
    outline:none;
  }
  .input::placeholder { color:#6b7280; }

  .search-btn{
    border:none; background:transparent; padding:.4rem; border-radius:8px;
    display:flex; align-items:center; justify-content:center;
    transition: background .15s ease, transform .1s ease;
  }
  .search-btn:hover{ cursor:pointer; background:rgba(0,0,0,.06); transform:scale(1.05); }

  .section-title{font-weight:800; margin:1rem 0 .5rem;}

  .results-wrap{margin-top:.75rem; border:1px solid #e5e7eb; border-radius:10px; background:#fff; overflow-x:auto; padding:.75rem;}
  .results-grid{display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap:1rem;}
  .results-col{display:grid; grid-template-rows:auto 1fr; gap:.5rem; min-width:0;}
  .results-heading{font-weight:800;}
  .results-row{--card-px:135px; --card-size:135px; display:grid; grid-auto-flow:column; grid-auto-columns:var(--card-px); gap:1.25rem;}

  :global(.card){width:var(--card-px)!important; display:grid; grid-template-rows:auto auto; gap:.6rem; border-radius:14px; cursor:pointer;}
  :global(.art){width:100%; aspect-ratio:1/1; border-radius:14px; overflow:hidden; background:#f3f4f6; box-shadow:0 2px 10px rgba(0,0,0,.06); border:1px solid #e5e7eb; transition:box-shadow .15s, transform .06s, border-color .15s;}
  :global(.card:hover .art){transform:translateY(-2px); box-shadow:0 8px 24px rgba(0,0,0,.12); border-color:#d1d5db;}
  :global(.thumb){width:100%!important; height:100%!important; object-fit:cover!important; object-position:center!important; display:block;}
  :global(.meta){display:grid; gap:.25rem; width:100%;}
  :global(.title){font-size:1.05rem; font-weight:800; color:#111827; line-height:1.2; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
  :global(.type){font-size:.9rem; color:#6b7280; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
  :global(.thumb), :global(.meta), :global(.title), :global(.type){pointer-events:none;}

  @media (max-width: 960px) {
    .results-grid{grid-template-columns: 1fr;}
  }
</style>

<h2 class="section-title">DB Search</h2>
<section id="dbSearchbar" class="searchbar theme-none" data-mode="none">
  <div class="modeBtns toggles">
    <button class="toggle" id="dbArtistBtn" type="button" aria-pressed="false">Artist</button>
    <button class="toggle" id="dbAlbumBtn"  type="button" aria-pressed="false">Album</button>
  </div>

  <div class="searchForm">
    <input class="input" id="dbQ" type="search" placeholder="Select Artist or Album first" />
  </div>

  <div class="searchBtnWrap">
    <button class="search-btn" id="dbSubmitBtn" type="button" title="Search DB" aria-label="Search">
      <!-- Search icon -->
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
           style="width:1.25em; height:1.25em; opacity:0.7;">
        <g stroke-linejoin="round" stroke-linecap="round" stroke-width="2.5" fill="none" stroke="currentColor">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.3-4.3"></path>
        </g>
      </svg>
    </button>
  </div>
</section>

<div class="results-wrap" id="dbResultsWrap" hidden>
  <div class="results-row" id="dbResultsRow"></div>
</div>

<!-- 아티스트 클릭 시 앨범행 -->
<div class="results-wrap" id="dbArtistAlbumsWrap" hidden>
  <div style="font-weight:700; margin-bottom:.5rem;" id="dbArtistAlbumsTitle"></div>
  <div class="results-row" id="dbArtistAlbumsRow"></div>
</div>

<h2 class="section-title" style="margin-top:1.25rem;">Spotify Search</h2>

<!-- 단일 검색바 -->
<section id="spSearchbar" class="searchbar theme-none">
  <div style="visibility:hidden; width:1px; height:1px;"></div> <!-- 자리 맞춤용 -->
  <div class="searchForm">
    <input id="spQ" class="input" type="text" placeholder="그냥 검색하세요 (예: BTS proof 2022)" />
  </div>
  <div class="searchBtnWrap">
    <button id="spSubmitBtn" class="search-btn" type="button" title="Search Spotify" aria-label="Search">
      <!-- Search icon -->
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
           style="width:1.25em; height:1.25em; opacity:0.7;">
        <g stroke-linejoin="round" stroke-linecap="round" stroke-width="2.5" fill="none" stroke="currentColor">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.3-4.3"></path>
        </g>
      </svg>
    </button>
  </div>
</section>

<!-- 결과 3열 -->
<div class="results-wrap" id="spResultsWrap" hidden>
  <div class="results-grid" id="spResultsGrid">
    <div class="results-col" id="spArtistsCol">
      <div class="results-heading">Artists</div>
      <div class="results-row" id="spArtistsRow"></div>
    </div>
    <div class="results-col" id="spAlbumsCol">
      <div class="results-heading">Albums</div>
      <div class="results-row" id="spAlbumsRow"></div>
    </div>
    <div class="results-col" id="spTracksCol">
      <div class="results-heading">Tracks</div>
      <div class="results-row" id="spTracksRow"></div>
    </div>
  </div>
</div>

<script type="module" src={dbClient}></script>
<script type="module" src={spClient}></script>