---
// PostGrid.astro
import type { CollectionEntry } from 'astro:content'

export interface Props {
  posts: CollectionEntry<'blog'>[]
}

const { posts } = Astro.props
---

<ul class="grid grid-cols-3 gap-5">
  {posts.map((entry) => {
    const post = entry.data
    const cover =
      (Array.isArray((post as any).albumCover) && (post as any).albumCover[0]) ||
      post.image ||
      '/default-cover.jpg'

    const href = `/blog/${post.slug}`

    return (
      <li class="card-grid-item">
        <a
          href={href}
          class="card-anchor group block h-full"
        >
          <div class="card-container flex h-full flex-col items-start">
            <div class="card-img-wrapper w-full overflow-hidden rounded-md bg-gray-200">
              <div class="relative w-full pb-[100%]">
                <img
                  src={cover}
                  alt={post.title}
                  loading="lazy"
                  class="card-img absolute inset-0 w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
                />
              </div>
            </div>

            <div class="card-info-wrapper mt-2 w-full text-left">
              <p class="body-3 card-title text-sm font-medium text-gray-900 group-hover:text-highlight line-clamp-2">
                {post.title}
              </p>

              <div class="card-info mt-1 flex flex-col gap-0.5">
                {post.category && (
                  <div class="artist-container">
                    <div class="caption-1 card-artist-name text-xs text-gray-600 line-clamp-1">
                      {post.category}
                    </div>
                  </div>
                )}

                <p class="caption-2 card-user-by text-[11px] text-gray-400">
                  {post.date instanceof Date
                    ? post.date.toLocaleDateString('ko-KR').replace(/\. /g, '.').replace(/\.$/, '')
                    : String(post.date)}
                </p>
              </div>
            </div>
          </div>
        </a>
      </li>
    )
  })}
</ul>